# üìã **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ Dismerge**

## üèóÔ∏è **–û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**

### **–ü–∞—Ç—Ç–µ—Ä–Ω: Entity-Component-System (ECS) —Å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º**
- **Board** - —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏–≥—Ä—ã
- **Cell** - —Å—Ç–∞—Ç–∏—á–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å–µ—Ç–∫–∏
- **Token** - –∏–≥—Ä–æ–≤—ã–µ —Ñ–∏—à–∫–∏ —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

---

## üéØ **–û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ (Entities)**

### **1. Board (–î–æ—Å–∫–∞)**
**–§–∞–π–ª:** `scripts/board.script`
**–†–æ–ª—å:** –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏–≥—Ä—ã

**–°–æ—Å—Ç–æ—è–Ω–∏—è:**
- `is_dragging` - —Ñ–ª–∞–≥ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
- `dragged_token` - ID –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º–æ–π —Ñ–∏—à–∫–∏
- `dragged_from` - –∏—Å—Ö–æ–¥–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è {x, y}
- `dragged_level` - —É—Ä–æ–≤–µ–Ω—å –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º–æ–π —Ñ–∏—à–∫–∏

**–î–∞–Ω–Ω—ã–µ:**
- `cells[x][y]` - –º–∞—Å—Å–∏–≤ —è—á–µ–µ–∫
- `tokens[key]` - —Å–ª–æ–≤–∞—Ä—å —Ñ–∏—à–µ–∫ –ø–æ –∫–ª—é—á—É "x_y"

**–ú–µ—Ç–æ–¥—ã:**
- `start_drag()` - –Ω–∞—á–∞–ª–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
- `handle_token_release()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—É—Å–∫–∞–Ω–∏—è
- `perform_merge()` - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–µ—Ä–¥–∂–∞
- `perform_move()` - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
- `perform_return()` - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—Ç–∞
- `clear_drag_state()` - –æ—á–∏—Å—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### **2. Cell (–Ø—á–µ–π–∫–∞)**
**–§–∞–π–ª:** `scripts/item_script.script`
**–†–æ–ª—å:** –°—Ç–∞—Ç–∏—á–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç —Å–µ—Ç–∫–∏

**–°–≤–æ–π—Å—Ç–≤–∞:**
- `grid_x`, `grid_y` - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ —Å–µ—Ç–∫–µ

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `sprite` - –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ

**–ú–µ—Ç–æ–¥—ã:**
- `on_message("clicked")` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞

### **3. Token (–§–∏—à–∫–∞)**
**–§–∞–π–ª:** `scripts/token.script`
**–†–æ–ª—å:** –ò–≥—Ä–æ–≤–∞—è —Ñ–∏—à–∫–∞ —Å —É—Ä–æ–≤–Ω–µ–º

**–°–≤–æ–π—Å—Ç–≤–∞:**
- `level` - —É—Ä–æ–≤–µ–Ω—å —Ñ–∏—à–∫–∏ (1-5)
- `grid_x`, `grid_y` - –ø–æ–∑–∏—Ü–∏—è –≤ —Å–µ—Ç–∫–µ
- `is_dragging` - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
- `move_target` - —Ü–µ–ª—å –¥–≤–∏–∂–µ–Ω–∏—è

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `sprite` - –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- `label` - —Ç–µ–∫—Å—Ç —Å —É—Ä–æ–≤–Ω–µ–º

**–ú–µ—Ç–æ–¥—ã:**
- `update_level_visual()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π: `start_drag`, `stop_drag`, `set_position`, `move_to`, `set_grid_position`, `update_level`

---

## üéÆ **–°–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã**

### **1. –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è:**
```
–ù–ï –ü–ï–†–ï–¢–ê–°–ö–ò–í–ê–ï–¢–°–Ø:
- is_dragging = false
- dragged_token = nil
- dragged_from = nil
- dragged_level = nil

–ü–ï–†–ï–¢–ê–°–ö–ò–í–ê–ï–¢–°–Ø:
- is_dragging = true
- dragged_token = <ID —Ñ–∏—à–∫–∏>
- dragged_from = {x, y}
- dragged_level = <—É—Ä–æ–≤–µ–Ω—å>
```

### **2. –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–∏—à–∫–∏:**
```
–õ–ï–ñ–ò–¢:
- is_dragging = false
- move_target = nil
- –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∏ —Ü–≤–µ—Ç

–ü–ï–†–ï–¢–ê–°–ö–ò–í–ê–ï–¢–°–Ø:
- is_dragging = true
- —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä (1.2x)
- –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π –±–µ–ª—ã–π —Ü–≤–µ—Ç

–î–í–ò–ñ–ï–¢–°–Ø:
- move_target = <–ø–æ–∑–∏—Ü–∏—è>
- –ø–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –∫ —Ü–µ–ª–∏
```

---

## üîÑ **–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π**

### **1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**
```
main.collection ‚Üí board_factorys.go ‚Üí board.script
board.script —Å–æ–∑–¥–∞–µ—Ç:
- cells[x][y] —á–µ—Ä–µ–∑ cell_factory
- tokens[key] —á–µ—Ä–µ–∑ token_factory
```

### **2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞:**
```
Mouse Input ‚Üí board.on_input() ‚Üí 
‚îú‚îÄ action.pressed ‚Üí start_drag()
‚îî‚îÄ action.released ‚Üí handle_token_release()
```

### **3. –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ:**
```
start_drag() ‚Üí 
‚îú‚îÄ –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ self.tokens[key]
‚îú‚îÄ msg.post(token, "start_drag")
‚îî‚îÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è

update() ‚Üí 
‚îî‚îÄ msg.post(token, "set_position") –¥–ª—è —Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∑–∞ –∫—É—Ä—Å–æ—Ä–æ–º
```

### **4. –û—Ç–ø—É—Å–∫–∞–Ω–∏–µ —Ñ–∏—à–∫–∏:**
```
handle_token_release() ‚Üí 
‚îú‚îÄ –ú–ï–†–î–ñ: perform_merge() ‚Üí —É–¥–∞–ª–µ–Ω–∏–µ + —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π
‚îú‚îÄ –ü–ï–†–ï–ú–ï–©–ï–ù–ò–ï: perform_move() ‚Üí –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –Ω–∞ –ø—É—Å—Ç—É—é —è—á–µ–π–∫—É
‚îî‚îÄ –í–û–ó–í–†–ê–¢: perform_return() ‚Üí –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞ –∏—Å—Ö–æ–¥–Ω—É—é –ø–æ–∑–∏—Ü–∏—é

clear_drag_state() ‚Üí 
‚îî‚îÄ msg.post(token, "stop_drag")
```

---

## üé® **–í–∏–∑—É–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞**

### **1. –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ —Ñ–∏—à–µ–∫:**
- **–£—Ä–æ–≤–µ–Ω—å 1:** –ö—Ä–∞—Å–Ω—ã–π
- **–£—Ä–æ–≤–µ–Ω—å 2:** –ó–µ–ª–µ–Ω—ã–π  
- **–£—Ä–æ–≤–µ–Ω—å 3:** –°–∏–Ω–∏–π
- **–£—Ä–æ–≤–µ–Ω—å 4:** –ñ–µ–ª—Ç—ã–π
- **–£—Ä–æ–≤–µ–Ω—å 5:** –ü—É—Ä–ø—É—Ä–Ω—ã–π

### **2. –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- **–ë–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä:** 0.8 + level * 0.1
- **–ü—Ä–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏:** 1.2x

### **3. Z-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:**
- **–Ø—á–µ–π–∫–∏:** z = 0
- **–§–∏—à–∫–∏:** z = 1 (–ø–æ–≤–µ—Ä—Ö —è—á–µ–µ–∫)

---

## üó∫Ô∏è **–°–∏—Å—Ç–µ–º–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç**

### **1. –°–µ—Ç–∫–∞:**
- **–†–∞–∑–º–µ—Ä:** 7x9 —è—á–µ–µ–∫
- **–†–∞–∑–º–µ—Ä —è—á–µ–π–∫–∏:** 64 –ø–∏–∫—Å–µ–ª—è
- **–°–º–µ—â–µ–Ω–∏–µ:** FIX_X = 300, FIX_Y = 300

### **2. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è:**
- `grid_to_screen(gx, gy)` - —Å–µ—Ç–∫–∞ ‚Üí —ç–∫—Ä–∞–Ω
- `find_cell_at_position(screen_x, screen_y)` - —ç–∫—Ä–∞–Ω ‚Üí —Å–µ—Ç–∫–∞

### **3. –ö–ª—é—á–∏ –¥–∞–Ω–Ω—ã—Ö:**
- `tokens[x .. "_" .. y]` - –∫–ª—é—á –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∏—à–µ–∫

---

## üîß **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**

### **1. –§–∞–±—Ä–∏–∫–∏ (Factories):**
- `cell_factory` - —Å–æ–∑–¥–∞–Ω–∏–µ —è—á–µ–µ–∫
- `token_factory` - —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏—à–µ–∫

### **2. –°–∏—Å—Ç–µ–º–∞ —Å–æ–æ–±—â–µ–Ω–∏–π:**
- `msg.post()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –º–µ–∂–¥—É –æ–±—ä–µ–∫—Ç–∞–º–∏
- `on_message()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

### **3. –ê–Ω–∏–º–∞—Ü–∏—è:**
- **–°–∫–æ—Ä–æ—Å—Ç—å:** 2500 –ø–∏–∫—Å–µ–ª–µ–π/—Å–µ–∫—É–Ω–¥—É
- **–ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è:** vmath.lerp –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏

### **4. –í–≤–æ–¥:**
- **–î–µ–π—Å—Ç–≤–∏–µ:** "touch" (MOUSE_BUTTON_1)
- **–û–±—Ä–∞–±–æ—Ç–∫–∞:** board.script –ø–æ–ª—É—á–∞–µ—Ç —Ñ–æ–∫—É—Å –≤–≤–æ–¥–∞

---

## üéØ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã**

### **1. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- Board –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –≤—Å—é –∏–≥—Ä–æ–≤—É—é –ª–æ–≥–∏–∫—É
- –Ø—á–µ–π–∫–∏ –∏ —Ñ–∏—à–∫–∏ - –ø–∞—Å—Å–∏–≤–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã

### **2. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:**
- Board - –∏–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
- Token - –≤–∏–∑—É–∞–ª –∏ –∞–Ω–∏–º–∞—Ü–∏—è
- Cell - —Å—Ç–∞—Ç–∏—á–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ

### **3. –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π:**
- –ß–µ—Ç–∫–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
- –ú–∏–Ω–∏–º—É–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏—Ö –∞–Ω–∏–º–∞—Ü–∏–π

### **4. –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å:**
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —É—Ä–æ–≤–Ω–∏ —Ñ–∏—à–µ–∫
- –ü—Ä–æ—Å—Ç–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–µ—Ö–∞–Ω–∏–∫

---

## üöÄ **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è**

### **1. –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**
- –°–∏—Å—Ç–µ–º–∞ –æ—á–∫–æ–≤
- –ê–Ω–∏–º–∞—Ü–∏–∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
- –ó–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω–∏

### **2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:**
- –ß–∏—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
- –ú–æ–¥—É–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- –ü—Ä–æ—Å—Ç—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

---

## üìÅ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤**

```
Dismerge/
‚îú‚îÄ‚îÄ main/
‚îÇ   ‚îú‚îÄ‚îÄ main.collection          # –ì–ª–∞–≤–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ board_factorys.go        # –§–∞–±—Ä–∏–∫–∏ –¥–ª—è –¥–æ—Å–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ board.go                 # –ü—Ä–æ—Ç–æ—Ç–∏–ø –¥–æ—Å–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ cell.go                  # –ü—Ä–æ—Ç–æ—Ç–∏–ø —è—á–µ–π–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ token.go                 # –ü—Ä–æ—Ç–æ—Ç–∏–ø —Ñ–∏—à–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ cell_factory.factory     # –§–∞–±—Ä–∏–∫–∞ —è—á–µ–µ–∫
‚îÇ   ‚îî‚îÄ‚îÄ token_factory.factory    # –§–∞–±—Ä–∏–∫–∞ —Ñ–∏—à–µ–∫
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ board.script             # –û—Å–Ω–æ–≤–Ω–∞—è –∏–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ token.script             # –õ–æ–≥–∏–∫–∞ —Ñ–∏—à–µ–∫
‚îÇ   ‚îî‚îÄ‚îÄ item_script.script       # –õ–æ–≥–∏–∫–∞ —è—á–µ–µ–∫
‚îú‚îÄ‚îÄ assets/
‚îÇ   ‚îú‚îÄ‚îÄ tile.atlas               # –ê—Ç–ª–∞—Å —Ç–µ–∫—Å—Ç—É—Ä
‚îÇ   ‚îú‚îÄ‚îÄ tile.png                 # –¢–µ–∫—Å—Ç—É—Ä–∞ —è—á–µ–µ–∫
‚îÇ   ‚îî‚îÄ‚îÄ token.png                # –¢–µ–∫—Å—Ç—É—Ä–∞ —Ñ–∏—à–µ–∫
‚îú‚îÄ‚îÄ input/
‚îÇ   ‚îî‚îÄ‚îÄ game.input_binding       # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–≤–æ–¥–∞
‚îú‚îÄ‚îÄ game.project                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îî‚îÄ‚îÄ tech-spec.md                 # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

---

## üîç **–ö–ª—é—á–µ–≤—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã**

### **1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Ä–¥–∂–∞:**
```lua
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –º–µ—Ä–¥–∂–∞
if target_token and target_token.level == self.dragged_level then
    -- –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–µ—Ä–¥–∂
end
```

### **2. –ü–ª–∞–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ:**
```lua
-- –í token.script
if self.move_target then
    local direction = self.move_target - current_pos
    local movement = vmath.normalize(direction) * move_speed * dt
    go.set_position(current_pos + movement, ".")
end
```

### **3. –ü–æ–∏—Å–∫ —è—á–µ–π–∫–∏ –ø–æ –ø–æ–∑–∏—Ü–∏–∏:**
```lua
-- –í board.script
local function find_cell_at_position(screen_x, screen_y)
    for x = 1, GRID_WIDTH do
        for y = 1, GRID_HEIGHT do
            local cell_pos = grid_to_screen(x, y)
            local distance = vmath.length(vmath.vector3(screen_x, screen_y, 0) - cell_pos)
            if distance <= CELL_SIZE / 2 then
                return { x = x, y = y }
            end
        end
    end
    return nil
end
```

---

–≠—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –æ—Ç–ª–∏—á–Ω—É—é –æ—Å–Ω–æ–≤—É –¥–ª—è –∏–≥—Ä—ã —Ç–∏–ø–∞ "Merge-2" —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è! üéÆ 