# üìã **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ Dismerge**

## üèóÔ∏è **–û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**

### **–ü–∞—Ç—Ç–µ—Ä–Ω: Entity-Component-System (ECS) —Å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º**
- **Board** - —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏–≥—Ä—ã
- **Cell** - —Å—Ç–∞—Ç–∏—á–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å–µ—Ç–∫–∏
- **Token** - –∏–≥—Ä–æ–≤—ã–µ —Ñ–∏—à–∫–∏ —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- **UI** - —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

---

## üéØ **–û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ (Entities)**

### **1. Board (–î–æ—Å–∫–∞)**
**–§–∞–π–ª:** `scripts/board.script`
**–†–æ–ª—å:** –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏–≥—Ä—ã

**–°–æ—Å—Ç–æ—è–Ω–∏—è:**
- `is_dragging` - —Ñ–ª–∞–≥ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
- `dragged_token` - ID –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º–æ–π —Ñ–∏—à–∫–∏
- `dragged_from` - –∏—Å—Ö–æ–¥–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è {x, y}
- `dragged_level` - —É—Ä–æ–≤–µ–Ω—å –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º–æ–π —Ñ–∏—à–∫–∏
- `dragged_evo_id` - ID —ç–≤–æ–ª—é—Ü–∏–æ–Ω–Ω–æ–π —Ü–µ–ø–æ—á–∫–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º–æ–π —Ñ–∏—à–∫–∏

**–î–∞–Ω–Ω—ã–µ:**
- `cells[x][y]` - –º–∞—Å—Å–∏–≤ —è—á–µ–µ–∫
- `tokens[key]` - —Å–ª–æ–≤–∞—Ä—å —Ñ–∏—à–µ–∫ –ø–æ –∫–ª—é—á—É "x_y"

**–ú–µ—Ç–æ–¥—ã:**
- `start_drag()` - –Ω–∞—á–∞–ª–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
- `handle_token_release()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—É—Å–∫–∞–Ω–∏—è
- `perform_merge()` - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–µ—Ä–¥–∂–∞
- `perform_move()` - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
- `perform_return()` - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—Ç–∞
- `clear_drag_state()` - –æ—á–∏—Å—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- `show_token_info()` - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∏—à–∫–µ
- `hide_token_info()` - —Å–∫—Ä—ã—Ç–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∏—à–∫–µ

### **2. Cell (–Ø—á–µ–π–∫–∞)**
**–§–∞–π–ª:** `scripts/item_script.script`
**–†–æ–ª—å:** –°—Ç–∞—Ç–∏—á–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç —Å–µ—Ç–∫–∏

**–°–≤–æ–π—Å—Ç–≤–∞:**
- `grid_x`, `grid_y` - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ —Å–µ—Ç–∫–µ

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `sprite` - –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ

**–ú–µ—Ç–æ–¥—ã:**
- `on_message("clicked")` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞

### **3. Token (–§–∏—à–∫–∞)**
**–§–∞–π–ª:** `scripts/token.script`
**–†–æ–ª—å:** –ò–≥—Ä–æ–≤–∞—è —Ñ–∏—à–∫–∞ —Å —É—Ä–æ–≤–Ω–µ–º –∏ —ç–≤–æ–ª—é—Ü–∏–æ–Ω–Ω–æ–π —Ü–µ–ø–æ—á–∫–æ–π

**–°–≤–æ–π—Å—Ç–≤–∞:**
- `level` - —É—Ä–æ–≤–µ–Ω—å —Ñ–∏—à–∫–∏ (1-12)
- `evo_id` - ID —ç–≤–æ–ª—é—Ü–∏–æ–Ω–Ω–æ–π —Ü–µ–ø–æ—á–∫–∏
- `grid_x`, `grid_y` - –ø–æ–∑–∏—Ü–∏—è –≤ —Å–µ—Ç–∫–µ
- `is_dragging` - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
- `move_target` - —Ü–µ–ª—å –¥–≤–∏–∂–µ–Ω–∏—è

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `sprite` - –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- `label` - —Ç–µ–∫—Å—Ç —Å —É—Ä–æ–≤–Ω–µ–º

**–ú–µ—Ç–æ–¥—ã:**
- `update_level_visual()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π: `start_drag`, `stop_drag`, `set_position`, `move_to`, `set_grid_position`, `update_level`, `update_evo_id`, `get_token_info`

### **4. UI (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)**
**–§–∞–π–ª:** `scripts/ui.script`
**–†–æ–ª—å:** –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∏—à–∫–∞—Ö

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `info_label` - label –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞

**–ú–µ—Ç–æ–¥—ã:**
- `on_message("show_token_info")` - –ø–æ–∫–∞–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∏—à–∫–µ
- `on_message("hide_token_info")` - —Å–∫—Ä—ã—Ç–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

---

## üîÑ **–°–∏—Å—Ç–µ–º–∞ —ç–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã—Ö —Ü–µ–ø–æ—á–µ–∫**

### **1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (config/evo.csv)**
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ CSV:**
```csv
Evo_ID,Name_str,NextEvo_ID,MaxGrade,1,2,3,4,5,6,7,8,9,10,11,12
TLS,Tools,CNS,8,–≥–≤–æ–∑–¥—å,–æ—Ç–≤—ë—Ä—Ç–∫–∞,—Ç–æ–ø–æ—Ä,–Ω–æ–∂,–Ω–æ–∂–æ–≤–∫–∞,–≥–∞–µ—á–Ω—ã–π –∫–ª—é—á,–ø–ª–æ—Å–∫–æ–≥—É–±—Ü—ã,–¥–æ–º–∫—Ä–∞—Ç
FNS,Finishing Tools,,9,—Ç—Ä—è–ø–∫–∞,–∫–∏—Å—Ç–æ—á–∫–∞,–≤–∞–ª–∏–∫ –¥–ª—è –∫—Ä–∞—Å–∫–∏,–∑–∞–∫—Ä—ã—Ç–∞—è –±–∞–Ω–∫–∞ –∫—Ä–∞—Å–∫–∏,–æ—Ç–∫—Ä—ã—Ç–∞—è –±–∞–Ω–∫–∞ –∫—Ä–∞—Å–∫–∏,–∫–ª–µ–π –¥–ª—è –æ–±–æ–µ–≤,–æ–±–æ–∏,–ø–ª–∏—Ç–∫–∞ –¥–ª—è –ø–æ–ª–∞,–ø–∞—Ä–∫–µ—Ç
```

**–ü–æ–ª—è:**
- `Evo_ID` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ü–µ–ø–æ—á–∫–∏
- `Name_str` - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ø–æ—á–∫–∏
- `NextEvo_ID` - ID —Å–ª–µ–¥—É—é—â–µ–π —Ü–µ–ø–æ—á–∫–∏ (–¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è)
- `MaxGrade` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –≤ —Ü–µ–ø–æ—á–∫–µ
- `1-12` - –Ω–∞–∑–≤–∞–Ω–∏—è –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è

### **2. –ú–æ–¥—É–ª—å evolution_tables (scripts/evolution_tables.lua)**
**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- `load_evolution_tables()` - –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ CSV
- `get_evolution_chain(evo_id)` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–ø–æ—á–∫–∏ –ø–æ ID
- `get_item_name(evo_id, level)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø—Ä–µ–¥–º–µ—Ç–∞
- `get_max_grade(evo_id)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è
- `get_next_evolution_id(evo_id)` - –ø–æ–ª—É—á–µ–Ω–∏–µ ID —Å–ª–µ–¥—É—é—â–µ–π —Ü–µ–ø–æ—á–∫–∏
- `get_merge_result(evo_id, level)` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –º–µ—Ä–¥–∂–∞

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:**
```lua
evolution_tables = {
    ["TLS"] = {
        id = "TLS",
        name = "Tools",
        next_evo_id = "CNS",
        max_grade = 8,
        levels = {
            [1] = "–≥–≤–æ–∑–¥—å",
            [2] = "–æ—Ç–≤—ë—Ä—Ç–∫–∞",
            -- ...
        }
    }
}
```

### **3. –õ–æ–≥–∏–∫–∞ –º–µ—Ä–¥–∂–∞**
**–ü—Ä–∞–≤–∏–ª–∞:**
1. –ú–µ—Ä–¥–∂ –≤–æ–∑–º–æ–∂–µ–Ω —Ç–æ–ª—å–∫–æ –º–µ–∂–¥—É —Ñ–∏—à–∫–∞–º–∏ –æ–¥–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è –∏ –æ–¥–Ω–æ–π —Ü–µ–ø–æ—á–∫–∏
2. –†–µ–∑—É–ª—å—Ç–∞—Ç –º–µ—Ä–¥–∂–∞ - —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å —Ç–æ–π –∂–µ —Ü–µ–ø–æ—á–∫–∏
3. –ü—Ä–∏ –º–µ—Ä–¥–∂–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è - –ø–µ—Ä–≤—ã–π —É—Ä–æ–≤–µ–Ω—å —Å–ª–µ–¥—É—é—â–µ–π —Ü–µ–ø–æ—á–∫–∏
4. –ï—Å–ª–∏ –Ω–µ—Ç —Å–ª–µ–¥—É—é—â–µ–π —Ü–µ–ø–æ—á–∫–∏ - –º–µ—Ä–¥–∂ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
```lua
function get_merge_result(evo_id, level)
    local chain = evolution_tables[evo_id]
    if level < chain.max_grade then
        return { evo_id = evo_id, level = level + 1 }
    elseif chain.next_evo_id then
        return { evo_id = chain.next_evo_id, level = 1 }
    else
        return nil -- —Ç—É–ø–∏–∫–æ–≤–∞—è —Ü–µ–ø–æ—á–∫–∞
    end
end
```

---

## üé® **–í–∏–∑—É–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞**

### **1. –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ —ç–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã—Ö —Ü–µ–ø–æ—á–µ–∫:**
- **TLS (Tools):** –ö—Ä–∞—Å–Ω—ã–π
- **FNS (Finishing Tools):** –ó–µ–ª–µ–Ω—ã–π
- **SPR (Spare Parts):** –°–∏–Ω–∏–π
- **CNS (Construction Materials):** –ñ–µ–ª—Ç—ã–π
- **LGH (Light):** –ü—É—Ä–ø—É—Ä–Ω—ã–π
- **ELC (Electrics):** –û—Ä–∞–Ω–∂–µ–≤—ã–π

### **2. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∏—à–∫–∞—Ö:**
**–¢—Ä–∏–≥–≥–µ—Ä:** –ö–ª–∏–∫ –∏–ª–∏ –Ω–∞—á–∞–ª–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è —Ñ–∏—à–∫–∏
**–§–æ—Ä–º–∞—Ç:** "–ù–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ø–æ—á–∫–∏ - –£—Ä–æ–≤–µ–Ω—å X - –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞"
**–ü—Ä–∏–º–µ—Ä:** "Tools - –£—Ä–æ–≤–µ–Ω—å 1 - –≥–≤–æ–∑–¥—å"

**–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:**
```
–ö–ª–∏–∫ –Ω–∞ —Ñ–∏—à–∫—É ‚Üí board.start_drag() ‚Üí 
show_token_info(evo_id, level) ‚Üí 
evolution_tables.get_evolution_chain() + get_item_name() ‚Üí 
msg.post("main:/ui", "show_token_info") ‚Üí 
ui.on_message() ‚Üí label.set_text()
```

### **3. –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- **–ë–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä:** 0.8 + level * 0.1
- **–ü—Ä–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏:** 1.2x

### **4. Z-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:**
- **–Ø—á–µ–π–∫–∏:** z = 0
- **–§–∏—à–∫–∏:** z = 1 (–ø–æ–≤–µ—Ä—Ö —è—á–µ–µ–∫)
- **UI:** z = 1 (–ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ)

---

## üîÑ **–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π**

### **1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**
```
main.collection ‚Üí board_factorys.go ‚Üí board.script
board.script —Å–æ–∑–¥–∞–µ—Ç:
- cells[x][y] —á–µ—Ä–µ–∑ cell_factory
- tokens[key] —á–µ—Ä–µ–∑ token_factory (—Å evo_id)
evolution_tables.load_evolution_tables() ‚Üí –∑–∞–≥—Ä—É–∑–∫–∞ CSV
```

### **2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞:**
```
Mouse Input ‚Üí board.on_input() ‚Üí 
‚îú‚îÄ action.pressed ‚Üí start_drag()
‚îî‚îÄ action.released ‚Üí handle_token_release()
```

### **3. –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ:**
```
start_drag() ‚Üí 
‚îú‚îÄ –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ self.tokens[key]
‚îú‚îÄ msg.post(token, "start_drag")
‚îú‚îÄ show_token_info(evo_id, level) ‚Üí –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
‚îî‚îÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è

update() ‚Üí 
‚îî‚îÄ msg.post(token, "set_position") –¥–ª—è —Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∑–∞ –∫—É—Ä—Å–æ—Ä–æ–º
```

### **4. –û—Ç–ø—É—Å–∫–∞–Ω–∏–µ —Ñ–∏—à–∫–∏:**
```
handle_token_release() ‚Üí 
‚îú‚îÄ –ú–ï–†–î–ñ: perform_merge() ‚Üí evolution_tables.get_merge_result() ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Ñ–∏—à–∫–∏
‚îú‚îÄ –ü–ï–†–ï–ú–ï–©–ï–ù–ò–ï: perform_move() ‚Üí –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –Ω–∞ –ø—É—Å—Ç—É—é —è—á–µ–π–∫—É
‚îî‚îÄ –í–û–ó–í–†–ê–¢: perform_return() ‚Üí –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞ –∏—Å—Ö–æ–¥–Ω—É—é –ø–æ–∑–∏—Ü–∏—é

clear_drag_state() ‚Üí 
‚îú‚îÄ msg.post(token, "stop_drag")
‚îî‚îÄ hide_token_info() ‚Üí —Å–∫—Ä—ã—Ç–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
```

### **5. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:**
```
–ö–ª–∏–∫ –Ω–∞ —Ñ–∏—à–∫—É ‚Üí 
board.show_token_info(evo_id, level) ‚Üí 
evolution_tables.get_evolution_chain() + get_item_name() ‚Üí 
msg.post("main:/ui", "show_token_info") ‚Üí 
ui.on_message() ‚Üí label.set_text("#info_label", info_text)
```

---

## üó∫Ô∏è **–°–∏—Å—Ç–µ–º–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç**

### **1. –°–µ—Ç–∫–∞:**
- **–†–∞–∑–º–µ—Ä:** 7x9 —è—á–µ–µ–∫
- **–†–∞–∑–º–µ—Ä —è—á–µ–π–∫–∏:** 64 –ø–∏–∫—Å–µ–ª—è
- **–°–º–µ—â–µ–Ω–∏–µ:** FIX_X = 300, FIX_Y = 300

### **2. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è:**
- `grid_to_screen(gx, gy)` - —Å–µ—Ç–∫–∞ ‚Üí —ç–∫—Ä–∞–Ω
- `find_cell_at_position(screen_x, screen_y)` - —ç–∫—Ä–∞–Ω ‚Üí —Å–µ—Ç–∫–∞

### **3. –ö–ª—é—á–∏ –¥–∞–Ω–Ω—ã—Ö:**
- `tokens[x .. "_" .. y]` - –∫–ª—é—á –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∏—à–µ–∫

---

## üîß **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**

### **1. –§–∞–±—Ä–∏–∫–∏ (Factories):**
- `cell_factory` - —Å–æ–∑–¥–∞–Ω–∏–µ —è—á–µ–µ–∫
- `token_factory` - —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏—à–µ–∫ (—Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ evo_id)

### **2. –°–∏—Å—Ç–µ–º–∞ —Å–æ–æ–±—â–µ–Ω–∏–π:**
- `msg.post()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –º–µ–∂–¥—É –æ–±—ä–µ–∫—Ç–∞–º–∏
- `on_message()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- `msg.post("main:/ui", ...)` - –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ UI —Å–∏—Å—Ç–µ–º—É

### **3. –ê–Ω–∏–º–∞—Ü–∏—è:**
- **–°–∫–æ—Ä–æ—Å—Ç—å:** 2500 –ø–∏–∫—Å–µ–ª–µ–π/—Å–µ–∫—É–Ω–¥—É
- **–ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è:** vmath.lerp –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏

### **4. –í–≤–æ–¥:**
- **–î–µ–π—Å—Ç–≤–∏–µ:** "touch" (MOUSE_BUTTON_1)
- **–û–±—Ä–∞–±–æ—Ç–∫–∞:** board.script –ø–æ–ª—É—á–∞–µ—Ç —Ñ–æ–∫—É—Å –≤–≤–æ–¥–∞

### **5. CSV –ø–∞—Ä—Å–∏–Ω–≥:**
- **–§–∞–π–ª:** config/evo.csv
- **–ö–æ–¥–∏—Ä–æ–≤–∫–∞:** UTF-8
- **–†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å:** –∑–∞–ø—è—Ç–∞—è
- **–û–±—Ä–∞–±–æ—Ç–∫–∞:** trim() –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–±–µ–ª–æ–≤

---

## üéØ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã**

### **1. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- Board –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –≤—Å—é –∏–≥—Ä–æ–≤—É—é –ª–æ–≥–∏–∫—É
- –Ø—á–µ–π–∫–∏ –∏ —Ñ–∏—à–∫–∏ - –ø–∞—Å—Å–∏–≤–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
- UI —Å–∏—Å—Ç–µ–º–∞ - –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å

### **2. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:**
- Board - –∏–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –∏ –º–µ—Ä–¥–∂
- Token - –≤–∏–∑—É–∞–ª –∏ –∞–Ω–∏–º–∞—Ü–∏—è
- Cell - —Å—Ç–∞—Ç–∏—á–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- UI - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- evolution_tables - –¥–∞–Ω–Ω—ã–µ —ç–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã—Ö —Ü–µ–ø–æ—á–µ–∫

### **3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ—Å—Ç—å:**
- –≠–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–µ —Ü–µ–ø–æ—á–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ CSV
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ü–µ–ø–æ—á–∫–∏ –∏ –ø—Ä–µ–¥–º–µ—Ç—ã
- –ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Ü–µ–ø–æ—á–∫–∞–º–∏

### **4. –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å:**
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —É—Ä–æ–≤–Ω–∏ —Ñ–∏—à–µ–∫
- –ü—Ä–æ—Å—Ç–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–µ—Ö–∞–Ω–∏–∫
- –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

---

## üöÄ **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è**

### **1. –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**
- –°–∏—Å—Ç–µ–º–∞ –æ—á–∫–æ–≤ –∑–∞ –º–µ—Ä–¥–∂–∏
- –ê–Ω–∏–º–∞—Ü–∏–∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –ø—Ä–∏ –º–µ—Ä–¥–∂–µ
- –ó–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω–∏
- –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ–∏—à–∫–∏ (–±–æ–Ω—É—Å—ã, –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è)
- –°–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π

### **2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:**
- –ß–∏—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
- –ú–æ–¥—É–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- –ü—Ä–æ—Å—Ç—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–µ —ç–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–µ —Ü–µ–ø–æ—á–∫–∏

---

## üìÅ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤**

```
Dismerge/
‚îú‚îÄ‚îÄ main/
‚îÇ   ‚îú‚îÄ‚îÄ main.collection          # –ì–ª–∞–≤–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ board_factorys.go        # –§–∞–±—Ä–∏–∫–∏ –¥–ª—è –¥–æ—Å–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ board.go                 # –ü—Ä–æ—Ç–æ—Ç–∏–ø –¥–æ—Å–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ cell.go                  # –ü—Ä–æ—Ç–æ—Ç–∏–ø —è—á–µ–π–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ token.go                 # –ü—Ä–æ—Ç–æ—Ç–∏–ø —Ñ–∏—à–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ ui.go                    # –ü—Ä–æ—Ç–æ—Ç–∏–ø UI
‚îÇ   ‚îú‚îÄ‚îÄ cell_factory.factory     # –§–∞–±—Ä–∏–∫–∞ —è—á–µ–µ–∫
‚îÇ   ‚îî‚îÄ‚îÄ token_factory.factory    # –§–∞–±—Ä–∏–∫–∞ —Ñ–∏—à–µ–∫
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ board.script             # –û—Å–Ω–æ–≤–Ω–∞—è –∏–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ token.script             # –õ–æ–≥–∏–∫–∞ —Ñ–∏—à–µ–∫
‚îÇ   ‚îú‚îÄ‚îÄ item_script.script       # –õ–æ–≥–∏–∫–∞ —è—á–µ–µ–∫
‚îÇ   ‚îú‚îÄ‚îÄ ui.script                # –õ–æ–≥–∏–∫–∞ UI
‚îÇ   ‚îî‚îÄ‚îÄ evolution_tables.lua     # –ú–æ–¥—É–ª—å —ç–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ evo.csv                  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —ç–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã—Ö —Ü–µ–ø–æ—á–µ–∫
‚îú‚îÄ‚îÄ assets/
‚îÇ   ‚îú‚îÄ‚îÄ tile.atlas               # –ê—Ç–ª–∞—Å —Ç–µ–∫—Å—Ç—É—Ä
‚îÇ   ‚îú‚îÄ‚îÄ tile.png                 # –¢–µ–∫—Å—Ç—É—Ä–∞ —è—á–µ–µ–∫
‚îÇ   ‚îî‚îÄ‚îÄ token.png                # –¢–µ–∫—Å—Ç—É—Ä–∞ —Ñ–∏—à–µ–∫
‚îú‚îÄ‚îÄ input/
‚îÇ   ‚îî‚îÄ‚îÄ game.input_binding       # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–≤–æ–¥–∞
‚îú‚îÄ‚îÄ game.project                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îî‚îÄ‚îÄ tech-spec.md                 # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

---

## üîç **–ö–ª—é—á–µ–≤—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã**

### **1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Ä–¥–∂–∞ —Å —ç–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–º–∏ —Ü–µ–ø–æ—á–∫–∞–º–∏:**
```lua
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –º–µ—Ä–¥–∂–∞
if target_token and 
   target_token.level == self.dragged_level and 
   target_token.evo_id == self.dragged_evo_id then
    -- –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–µ—Ä–¥–∂
    local merge_result = evolution_tables.get_merge_result(evo_id, level)
    if merge_result then
        -- –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ñ–∏—à–∫—É —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –º–µ—Ä–¥–∂–∞
    end
end
```

### **2. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∏—à–∫–µ:**
```lua
function show_token_info(self, evo_id, level)
    local chain = evolution_tables.get_evolution_chain(evo_id)
    local item_name = evolution_tables.get_item_name(evo_id, level)
    local info_text = chain.name .. " - –£—Ä–æ–≤–µ–Ω—å " .. level .. " - " .. item_name
    msg.post("main:/ui", "show_token_info", {
        chain_name = chain.name,
        level = level,
        item_name = item_name
    })
end
```

### **3. –ü–ª–∞–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ:**
```lua
-- –í token.script
if self.move_target then
    local direction = self.move_target - current_pos
    local movement = vmath.normalize(direction) * move_speed * dt
    go.set_position(current_pos + movement, ".")
end
```

### **4. –ü–æ–∏—Å–∫ —è—á–µ–π–∫–∏ –ø–æ –ø–æ–∑–∏—Ü–∏–∏:**
```lua
-- –í board.script
local function find_cell_at_position(screen_x, screen_y)
    for x = 1, GRID_WIDTH do
        for y = 1, GRID_HEIGHT do
            local cell_pos = grid_to_screen(x, y)
            local distance = vmath.length(vmath.vector3(screen_x, screen_y, 0) - cell_pos)
            if distance <= CELL_SIZE / 2 then
                return { x = x, y = y }
            end
        end
    end
    return nil
end
```

### **5. –ü–∞—Ä—Å–∏–Ω–≥ CSV —Ñ–∞–π–ª–∞:**
```lua
function parse_csv_line(line)
    local result = {}
    local current = ""
    local in_quotes = false
    
    for i = 1, #line do
        local char = line:sub(i, i)
        if char == '"' then
            in_quotes = not in_quotes
        elseif char == ',' and not in_quotes then
            table.insert(result, current)
            current = ""
        else
            current = current .. char
        end
    end
    table.insert(result, current)
    return result
end
```

---

–≠—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é –æ—Å–Ω–æ–≤—É –¥–ª—è –∏–≥—Ä—ã —Ç–∏–ø–∞ "Merge-2" —Å —Å–∏—Å—Ç–µ–º–æ–π —ç–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã—Ö —Ü–µ–ø–æ—á–µ–∫ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è! üéÆ 