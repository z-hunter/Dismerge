# Реализация индикаторов перезарядки генераторов

## Обзор

Реализована система индикаторов прогресса для отображения процесса перезарядки генераторов в игре Dismerge. Индикаторы показывают прогресс перезарядки генераторов с ручной активацией и автоматически удаляются при завершении перезарядки.

## Основные компоненты

### 1. Интеграция с модулем индикаторов
- Добавлен импорт модуля `Indicator` в `scripts/board.script`
- Используется существующий модуль `scripts/progress_indicator_module.lua`

### 2. Система управления индикаторами
- Добавлена таблица `self.generator_indicators` для хранения индикаторов по ключу "x_y"
- Реализованы функции управления индикаторами:
  - `show_generator_indicator()` - создание и показ индикатора
  - `remove_generator_indicator()` - удаление индикатора
  - `update_generator_visual()` - обновление визуала генератора

### 3. Интеграция с системой перезарядки
- Индикаторы автоматически появляются при начале перезарядки генератора
- Прогресс обновляется в реальном времени в функции `update_generators_visual()`
- Индикаторы автоматически удаляются при завершении перезарядки

## Визуальные характеристики

### Позиционирование
- Индикаторы размещаются в правом верхнем углу тайла генератора
- Смещение: `CELL_SIZE * 0.25` вправо и вверх от центра тайла
- Z-координата: `token_pos.z + 0.1` (поверх фишки)

### Масштабирование
- Индикаторы уменьшены в 4 раза: `vmath.vector3(0.25, 0.25, 1)`
- Это обеспечивает компактное отображение на тайле

### Цвет
- Синий цвет: `vmath.vector4(0.2, 0.6, 1.0, 1)`
- Соответствует цветовой схеме эволюционных цепочек

## Обработка перетаскивания

### При начале перетаскивания
- Индикатор автоматически удаляется с перетаскиваемого генератора
- Это предотвращает визуальные артефакты при перетаскивании

### При завершении перетаскивания
- В функции `perform_move()`: индикатор восстанавливается на новой позиции
- В функции `perform_return()`: индикатор восстанавливается на исходной позиции
- В функции `perform_merge()`: индикаторы удаляются с обеих фишек перед мерджем

## Интеграция с игровыми механиками

### Активация генератора
- При активации генератора вызывается `update_generator_visual()`
- Если генератор уходит на перезарядку, показывается индикатор
- Если генератор готов, индикатор удаляется

### Обновление в реальном времени
- В функции `update()` вызывается `update_generators_visual()`
- Это обеспечивает плавное обновление прогресса всех индикаторов

### Очистка ресурсов
- Добавлена функция `final()` для очистки всех индикаторов при завершении игры
- Предотвращает утечки памяти

## Конфигурация

### Параметры индикаторов
- **Масштаб**: 0.25x (уменьшен в 4 раза)
- **Цвет**: синий (0.2, 0.6, 1.0, 1)
- **Позиция**: правый верхний угол тайла
- **Z-слой**: поверх фишки (+0.1)

### Интеграция с конфигурацией генераторов
- Используется существующий модуль `scripts/generator_config.lua`
- Индикаторы работают только с генераторами, имеющими ручную активацию
- Время перезарядки берется из поля `M:Reload(sec)` в `config/gen.csv`

## Тестирование

Создан тестовый файл `test/test_generator_indicators.lua` для проверки:
- Создания и управления индикаторами
- Работы с конфигурацией генераторов
- Функций перезарядки

## Совместимость

Реализация полностью совместима с существующей архитектурой:
- Использует существующие модули и системы
- Не нарушает работу других механик игры
- Следует паттернам кодирования проекта

## Будущие улучшения

1. **Анимации**: Добавить плавные анимации появления/исчезновения индикаторов
2. **Звуковые эффекты**: Добавить звуки при завершении перезарядки
3. **Настройка позиции**: Сделать позицию индикатора настраиваемой
4. **Разные типы индикаторов**: Поддержка разных стилей для разных типов генераторов 